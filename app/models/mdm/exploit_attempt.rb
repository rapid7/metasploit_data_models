class Mdm::ExploitAttempt < ActiveRecord::Base
  
  #
  # Associations
  #

  # @!attribute host
  #   Host that was attempted to be exploited.
  #
  #   @return [Mdm::Host]
  belongs_to :host,
             class_name: 'Mdm::Host',
             counter_cache: :exploit_attempt_count,
             inverse_of: :exploit_attempts

  # @!attribute loot
  #   Loot gathers from the successful exploit.
  #
  #   @return [Mdm::Loot, nil]
  belongs_to :loot,
             class_name: 'Mdm::Loot',
             inverse_of: :exploit_attempt

  # @!attribute service
  #   The service being exploited on {#host}.
  #
  #   @return [Mdm::Service, nil]
  belongs_to :service,
             class_name: 'Mdm::Service',
             inverse_of: :exploit_attempts

  # @!attribute session
  #   The session that was established when this attempt was successful.
  #
  #   @return [Mdm::Session]
  #   @return [nil] if session was not established.
  belongs_to :session,
             class_name: 'Mdm::Session',
             inverse_of: :exploit_attempt

  # @!attribute vuln
  #   The vulnerability that was attempted to be exploited.
  #
  #   @return [Mdm::Vuln, nil]
  belongs_to :vuln,
             class_name: 'Mdm::Vuln',
             inverse_of: :exploit_attempts

  #
  # Mass Assignment Security
  #
  
  # Database Columns
  
  attr_accessible :attempted_at, :exploited, :fail_reason, :username, :module,
                  :port, :proto, :fail_detail
  
  # Foreign Keys
  
  attr_accessible :host_id, :service_id, :vuln_id, :session_id, :loot_id
  
  # Model Associations
  
  attr_accessible :host, :loot, :service, :session, :vuln
  
  #
  # Validations
  #

  validates :host_id, :presence => true

  Metasploit::Concern.run(self)
end
